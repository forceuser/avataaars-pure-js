<!doctype html>
<html>

	<head>
		<title>active-view demo</title>
		<style>
			svg {
				display: inline-block;
			}

			body {
				display: flex;
				justify-content: center;
				align-items: center;
				min-height: 100vh;
			}
		</style>
		<script src="./dist/avataaars-pure.js"></script>
	</head>

	<body>
		<script>
			const c = document.createElement("div");

			const avatar = Avataaar.avatar;
			const random = Avataaar.random;
			const gender = "F";
			const refferer = "ZuBDY4MeOm46FMN2qlvyR0iQ5GPCOBUwhjSaWrwYIRbqwOf_9xCt6J8VNUspm0xC";

			function hash (val) {
				val = val != null ? val.toString() : val;
			    let hash = 0;
			    if (val.length == 0) {
			        return hash;
			    }
			    for (var i = 0; i < val.length; i++) {
			        char = val.charCodeAt(i);
			        hash = ((hash << 5) - hash) + char;
			        hash = hash & hash; // Convert to 32bit integer
			    }
			    return Math.abs(hash);
			}

			c.innerHTML = random (avatar, null, (values, {path}, original) => {
				const randomVal = (collection, max) => {
					const h = hash(gender + "~" + refferer + "~" + path);
					if (max != null) {
						return h % max;
					}
					const keys = Object.keys(collection);

					return collection[keys[h % keys.length]];
				}

				if (path === "avatarStyle") {
					return original.indexOf("circle");
				}

				if (path === "body.color") {
					return randomVal(["pale", "light", "brown"]);
				}
				if (path === "face.eyes") {
					return randomVal(values.filter(val => !["cry", "dizzy", "hearts"].includes(val)));
				}

				if (path === "face.mouth") {
					return randomVal(values.filter(val => !["vomit", "sad", "disbelief", "grimace", "concerned", "serious", "screamOpen"].includes(val)));
				}
				if (path === "facialHair") {
					if (gender === "F") {
						return null;
					}
					else {
						if (randomVal(0, 5) === 0) {
							return randomVal(values.filter(val => val !== "blank"));
						}
						else {
							return null;
						}
					}

				}
				if (path === "face.eyebrow") {
					values = values.filter(val => !["unibrowNatural"].includes(val) && !val.startsWith("sad"));
					if (gender === "F") {
						return randomVal(values.filter(val => !["unibrowNatural"].includes(val)));
					}
				}

				if (path === "top") {
					if (gender === "F") {
						values = values.filter(val => val.startsWith("long") && !["longHairFroBand", "longHairFro", "hijab", "turban"].includes(val));
					}
					else {
						values = values.filter(val => !val.startsWith("long") && !["hijab", "turban"].includes(val));
					}
				}
				if (path === "accessory") {
					if (randomVal(0, 6) === 0) {
						return randomVal(values.filter(val => val !== "blank"));
					}
					else {
						return null;
					}
				}
				return randomVal(values);
			}).render();
			document.body.appendChild(c.children[0]);
		</script>
	</body>

</html>
